<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-puppet-module-openondemand">puppet-module-openondemand</h1>

<p><a href="https://forge.puppetlabs.com/osc/openondemand"><img
src="http://img.shields.io/puppetforge/v/osc/openondemand.svg"></a> <a
href="https://github.com/osc/puppet-module-openondemand/actions?query=workflow%3ACI"><img
src="https://github.com/osc/puppet-module-openondemand/workflows/CI/badge.svg?branch=master"></a></p>

<h4 id="label-Table+of+Contents">Table of Contents</h4>
<ol><li>
<p><a href="#overview">Overview</a></p>
<ul><li>
<p><a href="#supported-versions-of-open-ondemand">Supported Versions of Open
OnDemand</a></p>
</li></ul>
</li><li>
<p><a href="#usage">Usage - Configuration options</a></p>
</li><li>
<p><a href="#reference">Reference - Parameter and detailed reference to all
options</a></p>
</li><li>
<p><a href="#limitations">Limitations - OS compatibility, etc.</a></p>
</li></ol>

<h2 id="label-Overview">Overview</h2>

<p>Manage <a href="http://openondemand.org/">Open OnDemand</a> installation
and configuration.</p>

<h3 id="label-Supported+Versions+of+Open+OnDemand">Supported Versions of Open OnDemand</h3>

<p>The following are the versions of this module and the supported versions of
Open OnDemand:</p>
<ul><li>
<p>Module 2.x supports Open OnDemand 2.x</p>
</li><li>
<p>Module 1.x supports Open OnDemand 1.18.x</p>
</li><li>
<p>Module &lt;= 0.12.0 supports Open OnDemand &lt;= 1.7</p>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<p>All configuration can be done through the <code>openondemand</code> class.
Example configurations will be done in Hiera format.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_openondemand'>openondemand</span>
</code></pre>

<p>Install specific versions of OnDemand from 2.0 repo with OpenID Connect
support.</p>

<pre class="code ruby"><code class="ruby">openondemand::repo_release: &#39;2.0&#39;
openondemand::ondemand_package_ensure: &quot;2.0.0-1.el7&quot;
openondemand::mod_auth_openidc_ensure: &quot;2.4.5-1.el7&quot;
</code></pre>

<p>Configure OnDemand SSL certs</p>

<pre class="code ruby"><code class="ruby">openondemand::servername: ondemand.osc.edu
openondemand::ssl:
  - &quot;SSLCertificateFile /etc/pki/tls/certs/%{lookup(&#39;openondemand::servername&#39;)}.crt&quot;
  - &quot;SSLCertificateKeyFile /etc/pki/tls/private/%{lookup(&#39;openondemand::servername&#39;)}.key&quot;
  - &quot;SSLCertificateChainFile /etc/pki/tls/certs/%{lookup(&#39;openondemand::servername&#39;)}-interm.crt&quot;
</code></pre>

<p>If you already declare the apache class you may wish to only include apache
in this module:</p>

<pre class="code ruby"><code class="ruby">openondemand::declare_apache: false
apache::version::scl_httpd_version: &#39;2.4&#39;
apache::version::scl_php_version: &#39;7.0&#39;
apache::default_vhost: false
</code></pre>

<p>Add support for interactive apps</p>

<pre class="code ruby"><code class="ruby">openondemand::host_regex: &#39;[\w.-]+\.osc\.edu&#39;
openondemand::node_uri: &#39;/node&#39;
openondemand::rnode_uri: &#39;/rnode&#39;
</code></pre>

<p>Setup OnDemand to use default Dex authentication against LDAP.</p>

<pre class="code ruby"><code class="ruby">openondemand::servername: ondemand.example.org
openondemand::auth_type: dex
openondemand::dex_config:
  connectors:
    - type: ldap
      id: ldap
      name: LDAP
      config:
        host: ldap.example.org:636
        insecureSkipVerify: true
        bindDN: cn=admin,dc=example,dc=org
        bindPW: admin
        userSearch:
          baseDN: ou=People,dc=example,dc=org
          filter: &quot;(objectClass=posixAccount)&quot;
          username: uid
          idAttr: uid
          emailAttr: mail
          nameAttr: gecos
          preferredUsernameAttr: uid
        groupSearch:
          baseDN: ou=Groups,dc=example,dc=org
          filter: &quot;(objectClass=posixGroup)&quot;
          userMatchers:
            - userAttr: DN
              groupAttr: member
          nameAttr: cn
</code></pre>

<p>Setup OnDemand to authenticate with OpenID Connect system, in these
examples the IdP is Keycloak.</p>

<pre class="code ruby"><code class="ruby">openondemand::servername: ondemand.osc.edu
openondemand::auth_type: &#39;openid-connect&#39;
openondemand::auth_configs:
  - &#39;Require valid-user&#39;
openondemand::user_map_match: &#39;.*&#39;
openondemand::logout_redirect: &quot;/oidc?logout=https%3A%2F%2F%{lookup(&#39;openondemand::servername&#39;)}&quot;
openondemand::oidc_uri: &#39;/oidc&#39;
openondemand::oidc_provider_metadata_url: &#39;https://idp.osc.edu/auth/realms/osc/.well-known/openid-configuration&#39;
openondemand::oidc_scope: &#39;openid profile email groups&#39;
openondemand::oidc_client_id: ondemand.osc.edu
openondemand::oidc_client_secret: &#39;SUPERSECRET&#39;
openondemand::oidc_settings:
  OIDCPassIDTokenAs: &#39;serialized&#39;
  OIDCPassRefreshToken: &#39;On&#39;
  OIDCPassClaimsAs: environment
  OIDCStripCookies: &#39;mod_auth_openidc_session mod_auth_openidc_session_chunks mod_auth_openidc_session_0 mod_auth_openidc_session_1&#39;
</code></pre>

<p>Configure OnDemand via git repo that contains app configs, locales, public,
and annoucement files</p>

<pre class="code ruby"><code class="ruby">openondemand::servername: ondemand.osc.edu
openondemand::apps_config_repo: https://github.com/OSC/osc-ood-config.git
openondemand::apps_config_revision: v30
openondemand::apps_config_repo_path: &quot;%{lookup(&#39;openondemand::servername&#39;)}/apps&quot;
openondemand::locales_config_repo_path: &quot;%{lookup(&#39;openondemand::servername&#39;)}/locales&quot;
openondemand::public_files_repo_paths:
  - &quot;%{lookup(&#39;openondemand::servername&#39;)}/public/logo.png&quot;
  - &quot;%{lookup(&#39;openondemand::servername&#39;)}/public/favicon.ico&quot;
openondemand::announcements_config_repo_path: &quot;%{lookup(&#39;openondemand::servername&#39;)}/announcements&quot;
</code></pre>

<p>Define a SLURM cluster:</p>

<pre class="code ruby"><code class="ruby">openondemand::clusters:
  pitzer-exp:
    cluster_title: &#39;Pitzer Expansion&#39;
    url: https://www.osc.edu/supercomputing/computing/pitzer
    acls:
      - adapter: group
        groups:
          - oscall
        type: whitelist
    login_host: pitzer-exp.osc.edu
    job_adapter: slurm
    job_host: pitzer-slurm01.ten.osc.edu
    job_cluster: pitzer
    job_bin: /usr/bin
    job_lib: /usr/lib64
    job_conf: /etc/slurm/slurm.conf
</code></pre>

<p>Define a Torque cluster. The following example is based on a cluster at OSC
using Torque</p>

<pre class="code ruby"><code class="ruby">openondemand::clusters:
  owens:
    cluster_title: &#39;Owens&#39;
    url: &#39;https://www.osc.edu/supercomputing/computing/owens&#39;
    login_host: &#39;owens.osc.edu&#39;
    job_adapter: torque
    job_host: &#39;owens-batch.ten.osc.edu&#39;
    job_bin: /opt/torque/bin
    job_lib: /opt/torque/lib64
    job_version: &#39;6.0.1&#39;
    batch_connect:
      basic:
        script_wrapper: &#39;module restore\n%s&#39;
      vnc:
        script_wrapper: &#39;module restore\nmodule load ondemand-vnc\n%s&#39;
</code></pre>

<p>Define a Linux Host Adapter cluster:</p>

<pre class="code ruby"><code class="ruby">openondemand::clusters:
  pitzer-login:
    cluster_title: &#39;Pitzer Login&#39;
    url: https://www.osc.edu/supercomputing/computing/pitzer
    hidden: true
    job_adapter: linux_host
    job_submit_host: pitzer.osc.edu
    job_ssh_hosts:
      - pitzer-login01.hpc.osc.edu
      - pitzer-login02.hpc.osc.edu
      - pitzer-login03.hpc.osc.edu
    job_site_timeout: 7200
    job_debug: true
    job_singularity_bin: /usr/bin/singularity
    job_singularity_bindpath: /etc,/media,/mnt,/run,/srv,/usr,/var,/users,/opt
    job_singularity_image: /path/to/custom/image.sif
    job_strict_host_checking: false
    job_tmux_bin: /usr/bin/tmux
    batch_connect:
      vnc:
        script_wrapper: &#39;module restore\nmodule load ondemand-vnc\n%s&#39;
</code></pre>

<p>Define a Kubernetes cluster:</p>

<pre class="code ruby"><code class="ruby">openondemand::clusters:
  kubernetes:
    cluster_title: Kubernetes
    hidden: true
    job_adapter: kubernetes
    job_bin: /usr/local/bin/kubectl
    job_cluster: ood-prod
    job_username_prefix: prod
    job_namespace_prefix: &#39;user-&#39;
    job_server:
      endpoint: &quot;https://k8controler.example.com:6443&quot;
      cert_authority_file: /etc/pki/tls/kubernetes-ca.crt
    job_mounts:
      - name: home
        destination_path: /users
        path: /users
        host_type: Directory
        type: host
    job_auth:
      type: oidc
</code></pre>

<p>Add XDMoD support</p>

<p>Ensure the cluster definition has <code>xdmod_resource_id</code> set to
<code>resource_id</code> of the cluster in XDMoD. Also must do something
like the following to set the appropriate environment variable:</p>

<pre class="code ruby"><code class="ruby">openondemand::nginx_stage_pun_custom_env:
  OOD_XDMOD_HOST: http://xdmod.osc.edu
</code></pre>

<p>Install additional apps of specific versions as well as hide some apps</p>

<pre class="code ruby"><code class="ruby">openondemand::install_apps:
  bc_osc_rstudio_server:
    ensure: &quot;0.8.2-1.el7&quot;
  bc_desktop:
    mode: &#39;0700&#39;
</code></pre>

<p>Install additional apps from Git repos:</p>

<pre class="code ruby"><code class="ruby">openondemand::install_apps:
  bc_osc_rstudio_server:
    ensure: latest
    git_repo: https://github.com/OSC/bc_osc_rstudio_server.git
  bc_osc_jupyter:
    ensure: present
    git_repo: https://github.com/OSC/bc_osc_jupyter
    git_revision: v0.20.0
</code></pre>

<p>Add usr apps with a default group</p>

<pre class="code ruby"><code class="ruby">openondemand::usr_app_defaults:
  group: staff
openondemand::usr_apps:
  user1:
    gateway_src: /home/user1/ondemand/share
  user2:
    group: faculty
    gateway_src: /home/user2/ondemand/share
</code></pre>

<p>Add dev app users</p>

<pre class="code ruby"><code class="ruby">openondemand::dev_app_users:
  - user1
  - user2
</code></pre>

<p>Define some pinned apps and dashboard layout:</p>

<pre class="code ruby"><code class="ruby">openondemand::pinned_apps:
  - &#39;usr/*&#39;
  - &#39;sys/jupyter&#39;
  - type: dev
    category: system
openondemand::pinned_apps_menu_length: 10
openondemand::pinned_apps_group_by: category
openondemand::dashboard_layout:
  rows:
    - columns:
      - width: 8
        widgets:
          - pinned_apps
          - motd
      - width: 4
        widgets:
          - xdmod_widget_job_efficiency
          - xdmod_widget_jobs
</code></pre>

<p>Define some configurations for <code>/etc/ood/config/ondemand.d</code>.
This will generate
<code>/etc/ood/config/ondemand.d/pinned_apps.yml.erb</code> based on the
source file as well as
<code>/etc/ood/config/ondemand.d/dashboard_layout.yml</code> from a
template file. The example for <code>foobar</code> will generate the YAML
file using data defined in Hiera.</p>

<pre class="code ruby"><code class="ruby">openondemand::confs:
  pinned_apps:
    source: &#39;puppet:///modules/profile/openondemand/pinned_apps.yml.erb&#39;
    template: true
  dashboard_layout:
    content_template: &#39;profile/openondemand/dashboard_layout.yml.erb&#39;
  foobar:
    data:
      ...hash of configuration data here...
</code></pre>

<h2 id="label-Reference">Reference</h2>

<p><a
href="http://osc.github.io/puppet-module-openondemand/">osc.github.io/puppet-module-openondemand/</a></p>

<h2 id="label-Limitations">Limitations</h2>

<p>This module has been tested on:</p>
<ul><li>
<p>CentOS 7 x86_64</p>
</li><li>
<p>RedHat 7 x86_64</p>
</li><li>
<p>CentOS 8 x86_64</p>
</li><li>
<p>RedHat 8 x86_64</p>
</li></ul>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>